---
- name: Reset ISE GUI Password
  hosts: ise-azure
  connection: ansible.netcommon.network_cli
  gather_facts: no
  vars_files:
    - ~/Upgrade_ISE_in_Hybrid_Cloud/vars/main.yaml
    - ~/Upgrade_ISE_in_Hybrid_Cloud/vars/banners.yaml

  vars:
    ansible_network_os: cisco.ios.ios
    ansible_ssh_user: "{{ lookup('env','ISE_REST_USERNAME') }}"
    ansible_ssh_private_key_file: "{{ ssh_key_private_file }}.pub"
  # vars_prompt:
  #   - name: username
  #     prompt: What is the username to reset?
  #     default: iseadmin
  #     private: no
  #   - name: new_password
  #     prompt: What is the new password?
  #     private: yes
  tasks:
    
    - name: Password Reset | {{ ise_username }}@{{ inventory_hostname }}
      vars:
        ansible_command_timeout: 60
      ansible.netcommon.cli_command:
        command: "application reset-passwd ise {{ ise_username }}"
        check_all: yes
        # sendonly: no
        # newline: yes
        prompt:
          - "Enter new password:"
          - "Confirm new password:"
        answer: 
          - "{{ ise_password }}\r"
          - "{{ ise_password }}\r"
      register: output

    - name: output.stdout
      when:
        - output is defined
        - output.stdout is defined
      ansible.builtin.debug:
        var: output.stdout
        # verbosity: 3

    - name: Password Reset Successful
      ansible.builtin.debug:
        msg: |
                      ,•010101•,
                ,•0101010''1010101•,
            ,•0101010'`         '1010110•,
            1010'`                   '0101
            010         ,•010,         010
            101        10`  `10        101
            010       |01     10       010
            101      •01010101010      101
            1101    |0101010101010    ,010     Password Change was Successful on {{ inventory_hostname }}
             010    |1010101010101    010`
             \101   |0101010101010   /100
              1101  |1010101010101  0101
               '010,              ,0101
                 \100,          ,0100
                   101010,  ,•01010
                      '010101010`
                          ``