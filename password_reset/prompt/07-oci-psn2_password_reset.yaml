---
- name: Reset ISE GUI Password
  hosts: oci-psn
  connection: ansible.netcommon.network_cli
  gather_facts: false
    - ../../vars/main.yaml
    - ../../vars/banners.yaml
  vars:
    ansible_network_os: cisco.ios.ios
    ansible_ssh_user: "{{ lookup('env','ISE_REST_USERNAME') }}"
    ansible_ssh_private_key_file: "{{ ssh_key_private_file }}.pub"
  vars_prompt:
    - name: username
      prompt: What is the username to reset?
      default: iseadmin
      private: no
    - name: new_password
      prompt: What is the new password?
      private: yes
  tasks:

    #--------------------------------------------------------------------------
    # ðŸ’¡ ISE 3.2+ cloud instances use the superadmin account `iseadmin`
    #
    # ðŸ’¡ ISE Application Server must be running to reset password!
    #
    # ðŸ’¡ Possible errors:
    #    - Cannot reuse password within {{n}} days.
    # Example command output:
    #
    # ```
    # ise/iseadmin#application reset-passwd ise admin
    # Enter new password:
    # Confirm new password:
    #
    # Password reset successfully.
    # ```
    #--------------------------------------------------------------------------

    - name: GUI Password Reset | {{ username }}@{{ inventory_hostname }}
      ansible.netcommon.cli_command:
        command: "application reset-passwd ise {{ username }}"
        check_all: yes
        sendonly: no
        newline: yes
        prompt:
          - "Enter new password:"
          - "Confirm new password:"
        answer:
          - "{{ new_password }}"
          - "{{ new_password }}"
      register: output
      failed_when: "'successfully' not in output.stdout"

    - name: output.stdout
      when:
        - output is defined
        - output.stdout is defined
      ansible.builtin.debug:
        var: output.stdout
        # verbosity: 3

    - name: Exit | {{ inventory_hostname }}
      when: username == "admin"
      ansible.netcommon.cli_command:
        command: "exit"

    - name: Password Reset Successful
      ansible.builtin.debug:
        msg: |
          â€ƒ           ,â€¢010101â€¢,
          â€ƒ      ,â€¢0101010''1010101â€¢,
          â€ƒ ,â€¢0101010'`         '1010110â€¢,
          â€ƒ 1010'`                   '0101
          â€ƒ 010         ,â€¢010,         010
          â€ƒ 101        10`  `10        101
          â€ƒ 010       |01     10       010
          â€ƒ 101      â€¢01010101010      101
          â€ƒ 1101    |0101010101010    ,010     Password Change was Successful on {{ inventory_hostname }}
          â€ƒ  010    |1010101010101    010`
          â€ƒ  \101   |0101010101010   /100
          â€ƒ   1101  |1010101010101  0101
          â€ƒ    '010,              ,0101
          â€ƒ      \100,          ,0100
          â€ƒ        101010,  ,â€¢01010
          â€ƒ           '010101010`
          â€ƒ               ``